<html><head>
<meta name="viewport" content="width=device-width, initial-scale=0.75">
<meta charset="utf-8">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<title data-i18n="processing.title">Processingâ€¦ Please wait</title>
<link rel="stylesheet" href="/engine/skin/default/embeddedHpp.min.css?v=2087c3480adb" type="text/css">
	
		
		
			<link rel="stylesheet" href="/engine/skin/elastic-payments/embeddedHpp.css" type="text/css">
		
	
	<script src="/engine/includes/jquery-1.7.2.min.js" type="text/javascript"></script>
<script src="/engine/includes/jquery.timer.js" type="text/javascript"></script>
<script src="/engine/includes/jquery.uilock.min.js" type="text/javascript"></script>
<script src="/engine/includes/jquery-ui.js" type="text/javascript"></script>
<script src="/engine/includes/jquery.i18n.properties-min-1.0.9.js" type="text/javascript"></script>
<script src="/engine/includes/ee.i18n-1.0.min.js?v=2087c3480adb" type="text/javascript"></script>

     <script src="/engine/skin/elastic-payments/script.js" type="text/javascript"></script>

<!--[if lt IE 9]>
<script src="/engine/includes/html5shiv.js" ></script>
<![endif]-->

</head>
<body>
	<div>
	<form id="frmprocessing" method="post"></form>
	<form id="windowposting" method="post" target=""></form>
    </div>
    


	
	
		
			
			
				<div id="processing_box" class="hpp-container hpp-template-bg" style="">
    <div id="processing-box-title" class="hpp-form-title hpp-margin-v-10 hpp-template">
        <span id="title" data-i18n="please_wait">Please wait</span>
    </div>
    <hr id="title-processing-box-hr">
    <div class="hpp-loading-spinner"></div>
    <div id="processing-info-msg" class="hpp-processing-msg-box">
        <p id="processing-info-msg-text" data-i18n="processing_msg">Please do not use the back or refresh button during the payment process.  Please wait until the result has been processed...</p>
    </div>
</div>
			
		
	





    <div id="overlay" class="hpp-fixed-black-glass" style="display: none;"></div>
	<div id="modal" class="hpp-processing-modal" style="display: none;"><div id="content"></div></div>
	
		
		
		
	

<script type="text/javascript">

$(document).ready(function() {

	
	if (typeof mobileTransactionHandler != 'undefined') {
		$('.hpp-container').hide();
		if (mobileTransactionHandler.onProcessingStart) {
			mobileTransactionHandler.onProcessingStart();
		}
	} else {
		$.eei18n.init({
			init_locale: "en",
			psp: "elastic-payments",
			onTranslationFinished: function () {
				$("#processing_box").show();
			}
		});
	}

	
	var modal = (function() {
		var method = {},
			$overlay,
			$modal,
			$content,
			$close;

		// Center the modal in the viewport
		method.center = function() {
			var top, left;

			top = Math.max($(window).height() - $modal.outerHeight(), 0) / 2;
			left = Math.max($(window).width() - $modal.outerWidth(), 0) / 2;

			$modal.css({
				top: top + $(window).scrollTop(),
				left: left + $(window).scrollLeft()
			});
		};

		 // Open the modal
		 method.open = function(settings,width,height) {

		    $content.empty().append(settings.content);

			$content.css({
				width: width || settings.width || 'auto',
				height: height ||settings.height || 'auto'
			})

			method.center();
			$(window).bind('resize.modal', method.center);
			$modal.show();
			$overlay.show();
		};

		// Close the modal
		method.close = function() {
			$modal.hide();
			$overlay.hide();
			$content.empty();
			$(window).unbind('resize.modal');
		};

		$overlay = $("#overlay");
		$modal = $("#modal");
		$content = $('<div id="content"></div>');

		$modal.hide();
		$overlay.hide();
		$modal.append($content);

		// Generate the HTML and add it to the document
		return method;

	} ());

	
    
	    
	    
	    
	    
	    
	

});  //end of $(document).ready()

function openWindowPost(){
    $('#windowposting').attr('action','');
    
    window.open('about:blank', '','width=500,height=400,right=0,top=0');
    $('#windowposting').submit();
}

function reOpenWindow(){
	
	
	
	
	
	
}

var startTime = new Date(),
	timeout = parseInt('30000') || 600000;
	checkTimeoutForPending = parseInt('15000') || 0;
var pendingStartTime;



	
	
	var pollingUrl = '/engine/hpp/merchants/2a0e9351-24ed-4110-9a1b-fd0fee6bec26/payments/hppsearch?request_id=bb6a29bdac304980f3930d818bf1b273&request_signature=187a34a34551adbdfe4afe76730595a5e4958b7a11f89b41adf4d90e44181567&request_time_stamp=20191223091301';
	

	var pollingPendingUrl = pollingUrl + (pollingUrl.indexOf('?') === -1 ? '?' : '&') + 'search_pending=true';

var timer = $.timer(
	function() {
		var currentTime = new Date();
		var diff = currentTime - startTime;
		diff > timeout ? handleTimeout() : checkTransactionStatus(false);
	},
	5000,
	true
);

var pendingTimer;
var startPendingTimer = true;
function handleTimeout() {
	timer.stop();
	if (checkTimeoutForPending > 0) {
		if (startPendingTimer) {
			pendingStartTime = new Date();
			pendingTimer = $.timer(
					function () {
						var currentTime = new Date();
						var diff = currentTime - pendingStartTime;
						diff > checkTimeoutForPending ? handlePendingTimeout() : checkTransactionStatus(true);
					},
					5000,
					true
			);
			startPendingTimer = false;
		}
	} else {
		doAfterTimeout();
	}
}

function handlePendingTimeout() {
	pendingTimer.stop();
	doAfterTimeout();
}

function doAfterTimeout() {
		
		if (typeof mobileTransactionHandler != 'undefined' && mobileTransactionHandler.onTransactionChange) {
			mobileTransactionHandler.onTransactionChange('timeout');
		} else {
			$("#frmprocessing").attr('action', 'merchants/2a0e9351-24ed-4110-9a1b-fd0fee6bec26/timeout/bb6a29bdac304980f3930d818bf1b273');
			$("#frmprocessing").attr("method", "post");
			$('#frmprocessing').submit();
		}
}

function handleMerchantUrl(json){
    var hasUrl = false;
    $.each(json, function (key, value){
        if (key == 'merchanturl'  && value.length > 0) {
            hasUrl = true;
        }
    });
    if(!hasUrl){
        $('<input>').attr({type: 'hidden', id: 'code',        name: 'code1',        value: '400.1199' }).appendTo('#frmprocessing');
        $('<input>').attr({type: 'hidden', id: 'severity',    name: 'severity1',    value: 'error' }).appendTo('#frmprocessing');
        $('<input>').attr({type: 'hidden', id: 'description', name: 'description1',
            value: 'No redirect urls provided. Possible merchant account misconfiguration.' }).appendTo('#frmprocessing');
        $("#frmprocessing").attr('action', 'error');
        $("#frmprocessing").attr("method", "post");
        $('#frmprocessing').submit();
    }
}


function checkTransactionStatus(checkPending) {
	var responseData;
	$.ajax({
		headers: {
			"Content-Type": "application/x-www-form-urlencoded;charset=UTF-8"
		},
		type: 'GET',
		url: (checkPending ? pollingPendingUrl : pollingUrl),
		crossDomain: false,
		async: false,
	    dataType: 'json',
		success: function(json) {
			timer.stop();
			var hppRetry, returnMethod = '';

			handleMerchantUrl(json)

			
			if (typeof mobileTransactionHandler != 'undefined' && mobileTransactionHandler.onTransactionChange) {
				mobileTransactionHandler.onTransactionChange(JSON.stringify(json));
			} else {
				$.each(json, function (key, value) {
					if (key == 'merchanturl') {
						$('#frmprocessing').attr('action', value);
					} else if (key == 'hpp_retry_request_id') {
						hppRetry = value;
					}
					else if (key == 'merchantmethod') {
						returnMethod = value;
					} else {
						if (key == 'base64payload') {
							$('<input>').attr({
								type: 'hidden',
								id: 'eppresponse',
								name: 'eppresponse',
								value: value
							}).appendTo('#frmprocessing');
						} else {
							$('<input>').attr({
								type: 'hidden',
								id: key,
								name: key,
								value: value
							}).appendTo('#frmprocessing');
						}
					}
				});

				if (returnMethod) {
					window.location.replace($('#frmprocessing').attr('action'));
				} else if (hppRetry){
					window.location.replace(checkHppRetryStatus(hppRetry));
				}else {
					$('#frmprocessing').submit();
				}
			}
		},

		error: function (responseData, textStatus, errorThrown) {
		}
	});
	return false;
}


function checkHppRetryStatus(value){
	purl =  window.location.href;
	if(purl.endsWith("&")){
		purl = purl + "hpp_retry_request_id=" + value;
	}else{
		purl = purl + "&hpp_retry_request_id=" + value;
	}

	return purl;
}

function cancelUrl() {
	url = window.location.href;
	url = url.replace("&mode=qr", "&mode=cancel");
	$("#frmprocessing").attr('action', url );
	$("#frmprocessing").attr("method","post");
	$('#frmprocessing').submit();
}


</script>


</body></html>